$schema: "https://refinery.ai/schemas/hypothesis-pack/v1"
version: "1.0.0"

metadata:
  trace_id: "demo-trace-001"
  project: "demo-project"
  analyzed_at: "2025-10-15T14:32:15.000Z"
  refinery_version: "0.1.0"
  analysis_model: "gpt-5-preview"
  hypothesis_model: "gpt-5-preview"
  confidence_methodology: "evidence-based-ranking"
  total_analysis_time_ms: 12500

findings:
  - type: "gap"
    description: "Intent classifier misclassified billing query as general inquiry"
    evidence:
      - "User query: 'cancel my subscription and get a refund' → classified as 'general_inquiry'"
      - "Expected: 'billing_inquiry' or 'account_issue'"
      - "Classification confidence: 0.65 (below threshold: 0.80)"
    severity: "critical"
    affected_components:
      - "IntentClassifier"

hypotheses:
  - id: "hyp-001"
    description: "Add billing intent category with few-shot examples to classifier"
    rationale: "The classifier lacks training data for billing/subscription queries. Adding few-shot examples will improve classification accuracy by providing concrete examples of billing language patterns."
    confidence: "high"
    risks:
      - "Increases prompt token usage by ~200 tokens"
      - "May require rebalancing other intent categories"
    proposed_changes:
      - file_path: "prompts/intent_classifier/system.txt"
        change_type: "prompt_modification"
        description: "Add billing_inquiry intent category and few-shot examples"
        original_content: |
          You are an intent classifier. Classify the user's intent into one of:
          [general_inquiry, technical_support, account_issue]
        new_content: |
          You are an intent classifier. Classify the user's intent into one of:
          [general_inquiry, technical_support, billing_inquiry, account_issue]

          Examples:
          - 'cancel my subscription' → billing_inquiry
          - 'request a refund for last month' → billing_inquiry
          - 'update my payment method' → billing_inquiry
        diff: |
          --- prompts/intent_classifier/system.txt
          +++ prompts/intent_classifier/system.txt
          @@ -1,2 +1,7 @@
           You are an intent classifier. Classify the user's intent into one of:
          -[general_inquiry, technical_support, account_issue]
          +[general_inquiry, technical_support, billing_inquiry, account_issue]
          +
          +Examples:
          +- 'cancel my subscription' → billing_inquiry
          +- 'request a refund for last month' → billing_inquiry
          +- 'update my payment method' → billing_inquiry
    example_before: "User: 'cancel my subscription' → 'general_inquiry' (confidence: 0.65)"
    example_after: "User: 'cancel my subscription' → 'billing_inquiry' (confidence: 0.92)"
    generation_metadata:
      model: "gpt-5-preview"
      provider: "openai"
      max_tokens: 32000
      reasoning_effort: "high"
      diagnosis_hash: "sha256:a3f4b2c1d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2"
      created_at: "2025-10-15T14:32:10.000Z"
      attempts: 1

reproducibility:
  seed: null
  model_params:
    temperature: 0.0
    top_p: 1.0
    frequency_penalty: 0.0
    presence_penalty: 0.0
  diagnosis_hash: "sha256:a3f4b2c1d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2"
  refinery_config:
    analysis_model: "gpt-5-preview"
    hypothesis_model: "gpt-5-preview"
    hypothesis_reasoning_effort: "high"
